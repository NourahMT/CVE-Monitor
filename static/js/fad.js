

function expand_desc(i) {
// Expand and shrink the size of the clicked Description container
	if (document.getElementById('n' + i).style.maxHeight == "100ch") {
        document.getElementById('n' + i).style.maxHeight = "5ch";
        document.getElementById('n_img' + i).src = "static/images/angle-down.svg";
    } else {
        document.getElementById('n' + i).style.maxHeight = "100ch";
        document.getElementById('n_img' + i).src = "static/images/angle-up.svg";
    }
}

var data_req = function() {
// Send get request repeatedly depends on the waiting time specified by the server response
    $.ajax({
        url: "_get_data/",
        type: "GET",
        dataType: "JSON",
        success: function(data) {
            resp = data['data'];
            msgerror = data['msgerror'];
            waiting_time = data['next_req'];

            $('div#response2').empty().append(resp);
            $('div#error_msg').empty().append(msgerror);

            var res_time = new Date();

            // Send response time
            set_time(res_time);

            setTimeout(data_req, waiting_time);
        },
        error: function(resp) {
            $('p#error_msg').empty().append(resp);
        }
    });
};

var set_time = function(res_time) {
    var now = new Date();
    // Last response in minutes
    var mins = Math.abs(res_time - now) / 60000;

    if (mins < 5) {
        $('div#last_date').empty().append('Updated:' + '<span id="glow"> NOW</span>');
    } else {
        if (mins > 59) {
            var h = mins / 60;
            $('div#last_date').empty().append('Updated: ' + Math.trunc(h) + ' hours ago');

        } else {
            $('div#last_date').empty().append('Updated: ' + Math.trunc(mins) + '  minutes ago');
        }
    }
    // Call set_time to update time every 3 minutes
    setInterval(function() {
        set_time(res_time);
    }, 60000 * 3);
};
data_req();
